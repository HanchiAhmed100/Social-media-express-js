{"version":3,"file":"upload","sources":["../../../src/js/components/upload.js"],"sourcesContent":["function plugin(UIkit) {\n\n    if (plugin.installed) {\n        return;\n    }\n\n    var {addClass, ajax, matches, noop, on, removeClass, trigger} = UIkit.util;\n\n    UIkit.component('upload', {\n\n        props: {\n            allow: String,\n            clsDragover: String,\n            concurrent: Number,\n            maxSize: Number,\n            mime: String,\n            msgInvalidMime: String,\n            msgInvalidName: String,\n            msgInvalidSize: String,\n            multiple: Boolean,\n            name: String,\n            params: Object,\n            type: String,\n            url: String,\n        },\n\n        defaults: {\n            allow: false,\n            clsDragover: 'uk-dragover',\n            concurrent: 1,\n            maxSize: 0,\n            mime: false,\n            msgInvalidMime: 'Invalid File Type: %s',\n            msgInvalidName: 'Invalid File Name: %s',\n            msgInvalidSize: 'Invalid File Size: %s Bytes Max',\n            multiple: false,\n            name: 'files[]',\n            params: {},\n            type: 'POST',\n            url: '',\n            abort: noop,\n            beforeAll: noop,\n            beforeSend: noop,\n            complete: noop,\n            completeAll: noop,\n            error: noop,\n            fail: noop,\n            load: noop,\n            loadEnd: noop,\n            loadStart: noop,\n            progress: noop\n        },\n\n        events: {\n\n            change(e) {\n\n                if (!matches(e.target, 'input[type=\"file\"]')) {\n                    return;\n                }\n\n                e.preventDefault();\n\n                if (e.target.files) {\n                    this.upload(e.target.files);\n                }\n\n                e.target.value = '';\n            },\n\n            drop(e) {\n                stop(e);\n\n                var transfer = e.dataTransfer;\n\n                if (!transfer || !transfer.files) {\n                    return;\n                }\n\n                removeClass(this.$el, this.clsDragover);\n\n                this.upload(transfer.files);\n            },\n\n            dragenter(e) {\n                stop(e);\n            },\n\n            dragover(e) {\n                stop(e);\n                addClass(this.$el, this.clsDragover);\n            },\n\n            dragleave(e) {\n                stop(e);\n                removeClass(this.$el, this.clsDragover);\n            }\n\n        },\n\n        methods: {\n\n            upload(files) {\n\n                if (!files.length) {\n                    return;\n                }\n\n                trigger(this.$el, 'upload', [files]);\n\n                for (var i = 0; i < files.length; i++) {\n\n                    if (this.maxSize && this.maxSize * 1000 < files[i].size) {\n                        this.fail(this.msgInvalidSize.replace('%s', this.allow));\n                        return;\n                    }\n\n                    if (this.allow && !match(this.allow, files[i].name)) {\n                        this.fail(this.msgInvalidName.replace('%s', this.allow));\n                        return;\n                    }\n\n                    if (this.mime && !match(this.mime, files[i].type)) {\n                        this.fail(this.msgInvalidMime.replace('%s', this.mime));\n                        return;\n                    }\n\n                }\n\n                if (!this.multiple) {\n                    files = [files[0]];\n                }\n\n                this.beforeAll(this, files);\n\n                var chunks = chunk(files, this.concurrent),\n                    upload = files => {\n\n                        var data = new FormData();\n\n                        files.forEach(file => data.append(this.name, file));\n\n                        for (var key in this.params) {\n                            data.append(key, this.params[key]);\n                        }\n\n                        ajax(this.url, {\n                            data,\n                            method: this.type,\n                            beforeSend: env => {\n\n                                var xhr = env.xhr;\n                                xhr.upload && on(xhr.upload, 'progress', this.progress);\n                                ['loadStart', 'load', 'loadEnd', 'abort'].forEach(type =>\n                                    on(xhr, type.toLowerCase(), this[type])\n                                );\n\n                                this.beforeSend(env);\n\n                            }\n                        }).then(\n                            xhr => {\n\n                                this.complete(xhr);\n\n                                if (chunks.length) {\n                                    upload(chunks.shift());\n                                } else {\n                                    this.completeAll(xhr);\n                                }\n\n                            },\n                            e => this.error(e.message)\n                        );\n\n                    };\n\n                upload(chunks.shift());\n\n            }\n\n        }\n\n    });\n\n    function match(pattern, path) {\n        return path.match(new RegExp(`^${pattern.replace(/\\//g, '\\\\/').replace(/\\*\\*/g, '(\\\\/[^\\\\/]+)*').replace(/\\*/g, '[^\\\\/]+').replace(/((?!\\\\))\\?/g, '$1.')}$`, 'i'));\n    }\n\n    function chunk(files, size) {\n        var chunks = [];\n        for (var i = 0; i < files.length; i += size) {\n            var chunk = [];\n            for (var j = 0; j < size; j++) {\n                chunk.push(files[i + j]);\n            }\n            chunks.push(chunk);\n        }\n        return chunks;\n    }\n\n    function stop(e) {\n        e.preventDefault();\n        e.stopPropagation();\n    }\n\n}\n\nif (!BUNDLED && typeof window !== 'undefined' && window.UIkit) {\n    window.UIkit.use(plugin);\n}\n\nexport default plugin;\n"],"names":["this"],"mappings":"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"}